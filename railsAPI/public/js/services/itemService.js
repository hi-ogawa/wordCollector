// Generated by CoffeeScript 1.9.3
(function() {
  var ItemService;

  ItemService = function(AuthService, $resource) {
    var json2FormData, r, service;
    r = $resource("/api/items/:itemId", {
      itemId: "@itemId"
    }, {
      index: {
        method: "GET",
        transformResponse: function(data) {
          return angular.fromJson(data).items;
        },
        isArray: true
      },
      create: {
        method: "POST",
        transformRequest: angular.identity,
        headers: {
          Authorization: function() {
            return AuthService.getSession().token;
          },
          "Content-Type": void 0
        }
      },
      update: {
        method: "PUT",
        transformRequest: angular.identity,
        headers: {
          Authorization: function() {
            return AuthService.getSession().token;
          },
          "Content-Type": void 0
        }
      },
      destroy: {
        method: "DELETE",
        headers: {
          Authorization: function() {
            return AuthService.getSession().token;
          }
        }
      }
    });
    json2FormData = function(json) {
      var fd;
      fd = new FormData();
      _(json).mapObject(function(val, key) {
        if (!_.isObject(val)) {
          return fd.append(key, val);
        } else {
          return _(val).mapObject(function(valChild, keyChild) {
            return fd.append(key + "[" + keyChild + "]", valChild);
          });
        }
      });
      return fd;
    };
    service = {
      index: function() {
        return r.index();
      },
      create: function(item) {
        var fd;
        fd = json2FormData({
          category_id: item.category.id,
          item: _(item).pick(["word", "sentence", "meaning", "picture"])
        });
        return r.create(fd);
      },
      update: function(item) {
        return r.update({
          itemId: item.id
        }, json2FormData({
          category_id: item.category.id,
          item: _(item).pick(["word", "sentence", "meaning", "picture"])
        }));
      },
      destroy: function(item) {
        return r.destroy({
          itemId: item.id
        });
      }
    };
    return service;
  };

  ItemService.$inject = ["AuthService", "$resource"];

  angular.module("app").factory("ItemService", ItemService);

}).call(this);
