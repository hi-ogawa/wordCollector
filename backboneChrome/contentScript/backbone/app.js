// Generated by CoffeeScript 1.9.3
(function() {
  var app, root;

  app = {};

  app.DictionaryView = Backbone.View.extend({
    tagName: "div",
    className: "ext-dictionary panel",
    initialize: function(data) {
      this.template = _.template($("#ext-dictionary-t").html());
      this.$el.html(this.template({
        data: data
      }));
      return this.initPopover();
    },
    events: {
      "click .suggestion": function(e) {
        app.appView.$inputWord.val($(e.currentTarget).text());
        return app.appView.searchWord();
      }
    },
    initPopover: function() {
      var $popovers;
      $popovers = this.$('[data-toggle="popover"]');
      $popovers.each(function() {
        var $popoverContent;
        $popoverContent = $(this).next().clone();
        $popoverContent.find(".meaning").click(function() {
          return app.appView.$inputMeaning.val($(this).text());
        });
        $(this).popover({
          content: $popoverContent
        });
        return $(this).next().remove();
      });
      $popovers.mouseover(function() {
        return $(this).popover('show');
      }).on('show.bs.popover', function() {
        return $popovers.not($(this)).popover('hide');
      });
      return this.$el.mouseleave(function() {
        return $popovers.popover('hide');
      });
    }
  });

  app.AppView = Backbone.View.extend({
    initialize: function() {
      this.$dictionaries = this.$("#ext-dictionaries");
      this.$inputWord = this.$("#ext-word");
      this.$inputSentence = this.$("#ext-sentence");
      return this.$inputMeaning = this.$("#ext-meaning");
    },
    events: {
      "keypress #ext-word": function(e) {
        if (e.which === 13) {
          return this.searchWord();
        }
      }
    },
    searchWord: function() {
      var word;
      word = this.$inputWord.val().trim();
      if (word !== "") {
        this.$dictionaries.empty();
        extLib.Eijiro(word)["catch"](function(err) {
          return console.log("error in eijiro: " + err);
        }).then((function(_this) {
          return function(data) {
            if (_this.eijiroView != null) {
              _this.eijiroView.remove();
            }
            _this.eijiroView = new app.DictionaryView(data);
            return _this.$dictionaries.append(_this.eijiroView.$el);
          };
        })(this));
        return extLib.DictionaryAPI(word)["catch"](function(err) {
          return console.log("error in dicAPI: " + err);
        }).then((function(_this) {
          return function(data) {
            if (_this.dAPIView != null) {
              _this.dAPIView.remove();
            }
            _this.dAPIView = new app.DictionaryView(data);
            return _this.$dictionaries.append(_this.dAPIView.$el);
          };
        })(this));
      }
    }
  });

  $.get(chrome.extension.getURL("contentScript/contentScript.html"), function(data) {
    app.appView = new app.AppView({
      el: data
    });
    return $('body').append(app.appView.$el);
  });

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root.extBackboneApp = app;

}).call(this);
